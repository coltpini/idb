(function(global,factory){if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{var mod={exports:{}};factory(mod.exports);global.idbify=mod.exports}})(this,function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var Idbify=function(){function Idbify(_ref){var schema=_ref.schema,storeName=_ref.storeName,v=_ref.v;_classCallCheck(this,Idbify);this.schema=schema;this.storeName=storeName;this.v=v;this.go()}_createClass(Idbify,[{key:"go",value:function go(){var _this=this;return new Promise(function(res,rej){var iReq=indexedDB.open(_this.storeName,_this.v);iReq.addEventListener("error",function(e){return rej(e.target.error)});iReq.addEventListener("success",function(e){return res(e.target.result)});iReq.addEventListener("upgradeneeded",typeof _this.schema==="undefined"?rej("upgrade needed, but no schema"):function(e){return _this.upgrade(e.target.result)});iReq.addEventListener("blocked",function(e){return rej("blocked")})})}},{key:"upgrade",value:function upgrade(db){var options=this.schema[0].options||{};if(this.schema[0].type==="keyPath"){options.keyPath=this.schema[0].name}var os=db.createObjectStore(this.storeName,options);this.schema.filter(function(item){return item.type==="index"}).forEach(function(item){return os.createIndex(item.name,item.keyPath||item.name,item.options)})}},{key:"getTransaction",value:function getTransaction(db){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"readwrite";var trx=db.transaction(this.storeName,type);var store=trx.objectStore(this.storeName);return{trx:trx,store:store}}},{key:"put",value:function put(data){var _this2=this;return this.go().then(function(db){var _getTransaction=_this2.getTransaction(db),trx=_getTransaction.trx,store=_getTransaction.store;!Array.isArray(data)&&(data=[data]);data.forEach(function(item){return store.put(item)});return new Promise(function(res,rej){trx.oncomplete=function(){db.close();res("completed")};trx.onerror=function(e){return rej(e.target.error)}})})}},{key:"get",value:function get(key){var _this3=this;return this.go().then(function(db){var _getTransaction2=_this3.getTransaction(db,"readonly"),trx=_getTransaction2.trx,store=_getTransaction2.store;var read=store.get(key);return new Promise(function(res,rej){read.onsuccess=function(){return res(read.result)};read.onerror=function(){return rej("failed to read")}})})}},{key:"find",value:function find(_ref2){var _this4=this;var index=_ref2.index,term=_ref2.term,_ref2$type=_ref2.type,type=_ref2$type===undefined?"key":_ref2$type;return this.go().then(function(db){var _getTransaction3=_this4.getTransaction(db,"readonly"),trx=_getTransaction3.trx,store=_getTransaction3.store;var context=index?store.index(index):store;var cursor=term?context.openCursor(IDBKeyRange.only(term)):context.openCursor();return new Promise(function(res,rej){var results=[];cursor.onsuccess=function(e){var c=e.target.result;if(c){results.push(type==="value"?c.value:c.key);c.continue()}else{res(results)}};cursor.onerror=function(){return rej("finding failed")}})})}},{key:"delete",value:function _delete(key){var _this5=this;return this.go().then(function(db){var _getTransaction4=_this5.getTransaction(db),trx=_getTransaction4.trx,store=_getTransaction4.store;var remove=store.delete(key);return new Promise(function(res,rej){remove.onsuccess=function(){return res("deleted")};remove.onerror=function(){return rej("failed to delete")}})})}}]);return Idbify}();exports.default=Idbify});

//# sourceMappingURL=idbify.es5.js.map